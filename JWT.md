# JWT(`JSON WEB TOKEN`) 이해

세션 기반 인증과 토큰 기반 인증의 차이

로그인 상태를 서버에서 처리하는데 사용 할 수 있는 대표적인 두 가지 인증 방식

1. 세션
2. JWT 토큰

## **세션 기반 인증시스템**)

<br/>

세션 기반 인증시스템은 서버가 사용자가 로그인 중임을 기억하고 있다는 뜻

사용자가 로그인하면 서버는 세션 저장소에 사용자의 정보를 조회하고 세션 id를 발급
발급 된 id는 주로 브라우저의 쿠키에 저장

그 다음에 사용자가 다른 요청을 보낼 때마다 서버는 세션 저장소에서 세션을 조회한 후 로그인 여부를 결정하여 작업을 처리하고 응답,
세션 저장소는 주로 메모리, 디스크, 데이터베이스(DB)등을 사용함

세션 기반 인증의 단점은 서버를 확장하기가 번거로워질 수 있다는 특징이 있다.

만약의 서버의 인스턴스가 여러 개가 된다면, 모든 서버끼리 같은 세션을 공유해야 하므로 세션 전용 데이터베이스를 만들어야 할 뿐 아니라 신경 써야 할 것도 많다.

설계에 따라 충분히 좋은 시스템이 될 수 있다.

## **토큰 기반 인증시스템**)

<br/>

토큰은 로그인 이후 서버가 만들어주는 문자열,

해당 문자열 안에는 사용자의 로그인 정보가 들어있고, 해당 정보가 서버에서 발급 되었음을 증명하는 서명이 들어있음, (jwt 특징)

서명 데이터는 알고리즘을 통해 만들어지는데, 주로 HMAC SHA256 혹은 RSA256 알고리즘을 사용함 (암호화)

서버에서 만들어 준 토큰은 서명이 있기 때문에 무결성이 보장됩니다.

무결성이란 정보가 변경되거나 위조되지 않았음을 의미하는 성질입니다.
사용자가 로그인을 하면 서버에서 사용자에게 해당 사용자의 정보를 지니고 있는 토큰을 발급해주고,
추 후 사용자가 다른 api를 요청하게 될 때 발급받은 토큰과 함께 요청하게 되는데
토큰의 유효한지를 검사하면서 로그인 유무를 판단합니다.

토큰은 사용자를 기억하기 위해 사용하는 리소스가 적다는 것입니다.

사용자쪽에서 로그인 상태를 지닌 토큰을 가지고 있으므로 서버의 확장성이 매우 높습니다.

서버의 인스턴스가 여러개로 늘어나도 서버끼리 사용자의 로그인 상태를 공유하고 있을 필요가 없다.

## 토큰으로 인증 시스템 구현하기

순서

- User 스키마/모델만들기
- 회원인증 api 만들기
- 토큰 발급 및 검증하기
- 클라이언트 api에 회원인증 시스템 도입
- 클라이언트 api 회원인증 테스트

## 토큰 저장

1. 브라우저의 localStorage 혹은 sessionStorage

브라우저의 localStorage 혹은 ssessionStorage 에 토큰을 담으면 사용하기가 매우 편리하고 구현도 쉽다는 장점이있지만,
`XSS 크로스 사이트 스크립팅`, 악성 스크립트를 삽입하면 탈취 당할수도 있다는 단점이 있다.

2. 브라우저의 쿠키

쿠키에 담아도 같은 문제가 발생할 수 있지만, httpOnly 라는 속성을 활성화하면 자바스크립트를 통해 쿠키를 조회할 수 없으므로 XSS 공격으로부터는 안전하다.

하지만 `CSRF(cross site request forgery)` 공격에 취약해질 수 있다.

이공격은 토큰을 쿠키에 담으면 사용자가 서버로 요청을 할 때마다 무조건 토큰이 함께 전달되는 점을 이용해서 사용자가 모르게 원하지 않는 api 요청을 하게 만든다.

예를들어 사용자가 자신도 모르는 상황에서 어떠한 글을 작성하거나, 삭제하거나 또는 탈퇴하게 만들수도 있다.
// 저도 인스타그램 해킹당해서 불법토토 글이 여러개 올라 간 적이 있다..

### CSRF 공격방어)

CSRF 토큰 사용 및 Referer 검증 등의 방식으로 제대로 막을 수 있다.
Referer 는 어디서 요청을 보냈는지 확인 하는 것
